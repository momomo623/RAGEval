# RAG评测系统功能进度

## 后端已实现功能

✅ **用户账户与认证系统**
- 用户数据模型 (models/user.py)
- 认证机制 (core/security.py)
- 登录和注册API (api_v1/endpoints/auth.py)
- 用户服务逻辑 (services/user_service.py)

✅ **项目管理功能**
- 项目数据模型 (models/project.py)
- 项目API接口 (api_v1/endpoints/projects.py)
- 评测维度配置

✅ **问答数据管理**
- 问题数据模型 (models/question.py)
- 问题CRUD接口 (api_v1/endpoints/questions.py)
- 问题生成功能 (services/llm_service.py)
- 批量问题导入

✅ **RAG回答收集**
- RAG回答数据模型 (models/rag_answer.py)
- RAG回答接口 (api_v1/endpoints/rag_answers.py)
- RAG服务实现 (services/rag_service.py)
- 支持API调用和手动导入

✅ **评测引擎**
- 评测数据模型 (models/evaluation.py)
- 评测服务实现 (services/evaluation_service.py)
- 自动评测接口 (api_v1/endpoints/auto_evaluation.py)
- 人工评测接口 (api_v1/endpoints/manual_evaluation.py)
- 评测管理接口 (api_v1/endpoints/evaluations.py)

✅ **报告生成**
- 报告数据模型 (models/report.py)
- 报告服务 (services/report_service.py)
- 报告API (api_v1/endpoints/reports.py)
- 支持多种报告类型和导出格式

✅ **性能测试**
- 性能测试数据模型 (models/performance.py)
- 性能测试服务 (services/performance_service.py)
- 性能测试接口 (api_v1/endpoints/performance.py)
- 并发测试与性能分析

## 所有功能已实现完成


rag-evaluation-backend/
├── app/
│   ├── api/
│   │   ├── api_v1/
│   │   │   ├── endpoints/
│   │   │   │   ├── users.py
│   │   │   │   ├── auth.py
│   │   │   │   ├── projects.py
│   │   │   │   ├── questions.py
│   │   │   │   ├── rag_answers.py
│   │   │   │   ├── evaluations.py
│   │   │   │   ├── auto_evaluation.py
│   │   │   │   ├── manual_evaluation.py
│   │   │   │   ├── reports.py
│   │   │   │   └── performance.py
│   │   │   └── api.py
│   │   └── deps.py
│   ├── core/
│   │   ├── config.py
│   │   └── security.py
│   │
│   ├── db/
│   │   ├── base.py
│   │   ├── create.sql
│   │   ├── init_db.py
│   │   └── seed_db.py
│   │
│   ├── models/
│   │   ├── user.py
│   │   ├── project.py
│   │   ├── question.py
│   │   ├── rag_answer.py
│   │   ├── evaluation.py
│   │   └── performance.py
│   │
│   ├── schemas/
│   │   ├── user.py
│   │   ├── project.py
│   │   ├── question.py
│   │   ├── rag_answer.py
│   │   ├── evaluation.py
│   │   ├── performance.py
│   │   └── report.py
│   │
│   ├── services/
│   │   ├── user_service.py
│   │   ├── project_service.py
│   │   ├── question_service.py
│   │   ├── rag_service.py
│   │   ├── evaluation_service.py
│   │   ├── auto_evaluator.py
│   │   ├── report_service.py
│   │   └── llm_service.py
│   │
│   ├── utils/
│   │   ├── security.py
│   │   └── file_handlers.py
│   │
│   ├── __init__.py
│   └── main.py
│
└── requirements.txt 


# RAG评测系统功能设计文档

## 技术栈
### 前端
- **框架**: React 18 + TypeScript
- **UI组件**: Ant Design + ProComponents
- **状态管理**: Redux Toolkit
- **路由**: React Router v6
- **数据可视化**: AntV (G2Plot/BizCharts)
- **HTTP客户端**: Axios
- **表单处理**: Formik + Yup
- **构建工具**: Vite
- **代码规范**: ESLint + Prettier

### 后端
- **框架**: FastAPI (Python)
- **ORM**: SQLAlchemy
- **数据库**: PostgreSQL
- **缓存**: Redis
- **任务队列**: Celery
- **API文档**: Swagger UI (FastAPI内置)
- **认证**: JWT + OAuth2

### 部署与DevOps
- **容器化**: Docker + Docker Compose
- **CI/CD**: GitHub Actions
- **监控**: Prometheus + Grafana
- **日志**: ELK Stack (可选)

### 系统架构图

┌─────────────────────────────────────────────────────────────┐
│                      客户端 (浏览器)                          │
└───────────────────────────┬─────────────────────────────────┘
                            │
┌───────────────────────────▼─────────────────────────────────┐
│                      前端应用 (React)                         │
│                                                             │
│  ┌─────────────┐   ┌────────────┐   ┌────────────────────┐  │
│  │  组件 (Ant   │   │ 状态管理    │   │ 路由 (React Router) │  │
│  │   Design)   │   │ (Redux)    │   │                    │  │
│  └─────────────┘   └────────────┘   └────────────────────┘  │
│                                                             │
│  ┌─────────────┐   ┌────────────┐   ┌────────────────────┐  │
│  │ 图表 (AntV)  │   │ API客户端   │   │ 表单处理 (Formik)   │  │
│  │             │   │ (Axios)    │   │                    │  │
│  └─────────────┘   └────────────┘   └────────────────────┘  │
└───────────────────────────┬─────────────────────────────────┘
                            │
┌───────────────────────────▼─────────────────────────────────┐
│                     API网关 (Nginx)                          │
└───────────────────────────┬─────────────────────────────────┘
                            │
┌───────────────────────────▼─────────────────────────────────┐
│                    后端服务 (FastAPI)                         │
│                                                             │
│  ┌─────────────┐   ┌────────────┐   ┌────────────────────┐  │
│  │ 用户管理     │   │ 项目管理    │   │ 问答数据管理         │  │
│  └─────────────┘   └────────────┘   └────────────────────┘  │
│                                                             │
│  ┌─────────────┐   ┌────────────┐   ┌────────────────────┐  │
│  │ RAG回答收集  │   │ 评测引擎    │   │ 报告生成            │  │
│  └─────────────┘   └────────────┘   └────────────────────┘  │
└───┬───────────────────┬───────────────────┬─────────────────┘
    │                   │                   │
┌───▼───────┐   ┌───────▼───────┐   ┌───────▼───────┐
│ PostgreSQL │   │ Redis缓存     │   │ Celery任务队列 │
└───────────┘   └───────────────┘   └───────────────┘

## 1. 文档概述

### 1.1 目的与范围

本文档详细说明RAG评测系统的功能设计，重点关注核心功能和用户体验。系统设计秉承"简单易用"原则，让用户无需复杂配置即可快速评测RAG系统的回答准确性。

### 1.2 术语说明

- **RAG**：检索增强生成（Retrieval-Augmented Generation）
- **数据集**：包含问题和标准答案的集合，可被多个项目共享
- **问答对**：包含问题和标准答案的数据项
- **实际回答**：用户RAG系统对问题的回答结果
- **评测报告**：展示RAG系统性能的分析结果

## 2. 系统概览

### 2.1 技术架构

前端采用React框架构建简洁直观的界面，后端使用Python技术栈（FastAPI）开发API，数据存储采用PostgreSQL数据库。

### 2.2 核心功能模块

1. 用户账户（简化版）
2. 数据集管理
3. 评测项目
4. 问答数据管理
5. RAG回答收集
6. 自动评测引擎
7. 人工评测模块
8. 评测报告

## 3. 用户账户模块

### 3.1 快速注册与登录

- **简易注册**：
  - 仅需邮箱和密码
  - 可选GitHub一键登录
- **无验证流程**：注册即可使用，避免邮箱验证等额外步骤
- **保存设置**：记住登录状态，减少重复登录

### 3.2 用户个人设置
- **个人信息**：
  - 个人资料编辑
  - 密码修改
- **API密钥管理**：
  - 创建和删除个人API密钥

## 4. 数据集管理模块

### 4.1 数据集创建与管理

- **简易创建流程**：
  - 数据集名称、描述和可见性设置
  - 支持公开/私有选项
  - 标签分类功能

- **数据集列表视图**：
  - 数据集卡片展示
  - 筛选功能（名称、标签、创建时间）
  - 快速预览数据集内容

### 4.2 问答对管理

#### 4.2.1 多种数据获取方式

- **Excel/CSV简易导入**：
  - 拖拽上传支持
  - 智能列名识别
  - 提供标准模板下载

- **基于大模型生成问答对**：
  - 根据知识库内容生成问题和标准答案
  - 支持文本直接输入或文件上传
  - 生成参数配置（难度、类型、数量）

#### 4.2.2 问答数据管理

- **列表视图**：简洁的问题和答案列表
- **快速编辑**：行内直接编辑问题和答案
- **批量操作**：删除、移动到其他数据集
- **搜索功能**：关键词搜索特定问题

## 5. 评测项目模块

### 5.1 一键创建项目

- **简化创建流程**：
  - 项目名称和描述
  - 选择已有数据集（可选择多个）
  - 预设默认评测标准
  
- **项目卡片展示**：
  - 直观的项目卡片视图
  - 显示关键信息（名称、创建时间、评测状态）
  - 一键进入评测流程

### 5.2 评测配置

#### 5.2.1 评测标准设置
- **评测维度**：
  - 准确性（事实一致性）
  - 相关性（回答与问题的匹配度）
  - 完整性（信息覆盖度）
  - 简洁性（无冗余信息）
- **评分规则**：
  - 二元评分（正确/错误）
  - 三分量表（较差/一般/优秀）
  - 五分量表（1-5分）
  - 自定义评分标准
- **权重设置**：
  - 各维度权重调整
  - 评分规则权重

#### 5.2.2 评测流程配置
- **评测方式**：
  - 自动评测
  - 人工评测
  - 混合评测（先自动后人工审核）
- **评测设置**：
  - 评测批次大小
  - 时间限制
  - 评测人分配规则

## 6. RAG回答收集模块

### 6.1 API接口设置

- **简化接口配置**：
  - URL输入框
  - 简单认证选项（无认证/API密钥/Basic认证）
  - 可选请求参数配置
- **一键测试**：验证接口连接是否正常

### 6.2 批量回答收集

- **一键批量请求**：
  - 自动发送所有问题到RAG接口
  - 简单进度展示
  - 错误重试选项
- **Excel导入回答**：
  - 支持直接上传包含RAG回答的Excel
  - 自动匹配问题和回答

## 7. 自动评测引擎

### 7.1 评测类型与流程

- **三种评测模式**：
  - **AI评测**：完全由大模型自动评估RAG回答质量
  - **人工评测**：通过人工评分员判断RAG回答质量
  - **混合评测**：先AI评测，后人工复核，获取更高质量评测结果

- **评测流程**：
  - **创建评测任务**：选择项目、数据集、评测模式和评分方法
  - **配置评测参数**：选择评测维度、权重和模型参数
  - **执行评测**：系统自动批量处理或分配人工评测任务
  - **查看结果**：展示评分结果、详细分析和对比报告

### 7.2 评测维度

- **核心维度**：
  - **准确性**（默认）：RAG回答与标准答案的事实一致程度
  - **相关性**：回答与问题的匹配度和针对性
  - **完整性**：回答对问题信息的覆盖程度
  - **简洁性**：回答是否无冗余信息，直击要点

- **维度配置**：
  - 可选择启用/禁用特定维度
  - 支持为各维度设置不同权重
  - 权重范围：0.1-1.0，默认均为1.0

### 7.3 评分方法

- **二元评分(binary)**：
  - 正确(1分)/错误(0分)
  - 适合简单事实类问题的快速评测

- **三分量表(three_scale)**：
  - 正确(1分)/部分正确(0.5分)/错误(0分)
  - 或优秀(2分)/一般(1分)/较差(0分)
  - 适合大多数场景的平衡评测

- **五分量表(five_scale)**：
  - 1-5分制，更细粒度的质量评估
  - 适合需要精细区分质量差异的场景

### 7.4 AI评测功能

- **模型配置**：
  - 支持配置评测模型名称、温度等参数
  - 支持自定义评测提示词模板
  - 兼容OpenAI接口标准的模型服务

- **批量处理**：
  - 自动分批处理大量评测项
  - 智能重试失败项
  - 实时展示评测进度和临时结果

- **评测结果**：
  - 生成总体评分和各维度评分
  - 提供每个回答的评测理由
  - 支持导出详细评测报告

### 7.5 人工评测功能

- **访问码机制**：
  - 系统自动生成唯一评测访问码
  - 无需评测人注册账户，通过访问码直接参与评测
  - 支持设置访问码有效期和启用/禁用控制

- **评测界面**：
  - 清晰的三栏布局（问题/标准答案/RAG回答）
  - 简洁直观的评分控件
  - 可选的评测理由输入框

- **评测管理**：
  - 分配特定评测项给不同评测人
  - 跟踪评测进度和完成情况
  - 查看和比较不同评测人的评分结果

### 7.6 混合评测模式

- **工作流程**：
  - 首先进行AI自动评测，获取初步结果
  - 然后分配给人工评测人员进行审核
  - 人工评测人可以参考AI评测结果，进行确认或修改
  - 系统根据配置规则决定采用最终评分（默认优先采用人工结果）

- **优势**：
  - 减轻人工评测负担，提高效率
  - 保证关键评测结果的人工审核质量
  - 提供AI与人工评测结果对比，发现模式和差异

### 7.7 评测结果分析

- **总体分析**：
  - 平均分和各维度得分统计
  - 分数分布图和质量分布
  - 识别优秀回答和问题回答

- **详细数据**：
  - 每个问题的评测详情
  - AI和人工评测结果对比（混合模式）
  - 评测理由分析

- **结果导出**：
  - 支持PDF/Excel/CSV格式导出
  - 可自定义导出字段和内容
  - 支持筛选后导出
## 8 性能评测功能
### 8.1 性能评测概述
- **评测目标**：评估RAG系统在不同负载下的响应性能和稳定性
- **测试管理**：
  - 创建命名的性能测试
  - 关联到特定项目和数据集
  - 记录测试配置和版本信息
  - 支持多种测试模式（标准/压力/稳定性）
### 8.2 性能指标收集
- **并发请求配置**：
  - 支持设置并发请求数量（1-20）
  - 可配置测试模式（标准模式、压力测试、稳定性测试）
  
- **响应时间指标**：
  - 首次响应时间：从发送请求到系统开始返回数据的时间
  - 总响应时间：从发送请求到接收完整回答的时间
  - 平均/最小/最大响应时间
  - 分位数响应时间（P50/P90/P95）

- **吞吐量指标**：
  - 每秒请求处理数
  - 每秒字符生成数
  - 成功率统计

### 8.3 性能数据展示
- **实时性能监控**：
  - 测试过程中实时显示关键性能指标
  - 动态更新成功率和请求计数

- **综合性能报告**：
  - 核心指标卡片展示
  - 响应时间分布图表
  - 随并发量变化的性能趋势图
  - 吞吐量和字符生成速度分析

- **详细测试数据**：
  - 单个问题的详细性能记录
  - 失败请求的错误分析
  - 性能异常值标识

### 8.4 性能测试模式
- **标准模式**：均衡测试基本性能指标，适合日常评估
- **压力测试**：高并发下系统表现评估，测试系统极限
- **稳定性测试**：长时间运行，评估系统稳定性和资源利用

### 8.5 性能数据导出与分享
- 支持性能报告导出（PDF/Excel/CSV）
- 测试结果的图表导出与分享
- 历史测试数据对比分析

### 8.6 性能与RAG回答集成
- 性能测试过程中收集的RAG回答自动保存
- 可用于后续质量评测和比对分析
- 支持按版本跟踪性能与质量变化

## 8. 人工评测模块

### 8.1 简易评测界面

- **直观评测页面**：
  - 清晰的三栏布局（问题/标准答案/RAG回答）
  - 评分控件直接显示在每个问答对下方
  - 夜间模式支持，降低长时间评测疲劳
- **评分操作**：
  - 快速评分按钮（正确/部分正确/错误）
  - 简单评分滑块（1-5分）
  - 可选简短评论输入框
- **批量评测功能**：
  - 列表视图同时展示多个问答对
  - 批量应用相同评分
  - 记住上次停留位置，支持分批评测

### 8.2 评测辅助功能

- **简易对比工具**：
  - 自动高亮RAG回答与标准答案的差异
  - 关键词匹配突出显示
- **评测进度**：
  - 直观进度条显示（已评测/总数量）
  - 简单统计（平均分、已完成百分比）
- **记录功能**：
  - 自动保存评测结果
  - 简单筛选（已评测/未评测/有问题的项目）

### 8.3 混合评测模式

- **设计说明**：结合自动评测和人工评测优势
- **工作流程**：
  1. 先进行自动评测获得初步结果
  2. 人工重点审核可疑或有争议的回答
  3. 人工可一键确认或修改自动评测结果
- **重点审核推荐**：
  - 自动标记评分较低的问题
  - 标记自动评测低置信度的问题
  - 用户可设置分数阈值触发人工审核

### 8.4 简化版评测指南

- **内嵌评分标准**：
  - 每个评分选项附带简短解释
  - 可访问评分示例（好/中/差的样例）
- **评测提示**：
  - 简短提示帮助保持评测一致性
  - 常见误区提醒

## 9. 评测报告模块

### 9.1 一目了然的评测结果

- **总体评分**：
  - 分数和百分比展示
  - 简单色彩编码（红/黄/绿）
  - 与历史对比（如有）
- **问题分布**：
  - 按评分分布的简单图表
  - 问题类型表现对比

### 9.2 问题详情

- **列表视图**：
  - 问题-标准答案-RAG回答-评分的并排展示
  - 按评分排序（最差在前）
  - 简单筛选功能
- **详情查看**：
  - 点击展开完整内容
  - 评测理由展示
  - 简单的差异高亮

### 9.3 简易导出功能

- **一键导出**：
  - PDF报告
  - Excel详细结果
  - 问题集导出（仅错误问题）




## 10. 系统配置模块

### 10.1 概述

系统配置模块允许用户配置与保存大模型API和RAG系统API的连接参数，所有配置均存储在浏览器本地存储中，确保数据隐私安全。这些配置在评测过程中用于连接外部服务。

### 10.2 配置存储机制

- **存储位置**：浏览器本地存储 (localStorage)
- **数据格式**：JSON字符串
- **持久化**：配置将永久保存，直到用户主动清除或浏览器数据被清除
- **存储键**：
  - LLM配置: `rag_eval_llm_config`
  - RAG系统配置: `rag_eval_rag_config`

### 10.3 配置项

#### 10.3.1 LLM模型配置（OpenAI接口规范）

支持所有兼容OpenAI接口的大语言模型服务：

- **基础URL**: API服务地址（如OpenAI等）
- **API密钥**: 服务认证密钥
- **模型名称**: 使用的模型标识符
- **高级参数**: 可选的模型参数（如温度、最大生成长度等）

#### 10.3.2 RAG系统配置

支持自定义RAG系统API调用：

- **API接口地址**: RAG系统的接口URL
- **请求头**: 包含认证信息和其他HTTP头的JSON对象
- **请求模板**: 包含占位符的JSON请求模板
- **响应路径**: 从响应JSON中提取回答的属性路径

### 10.4 配置界面

通过模态窗口提供直观的配置界面：

- **标签页**: 分离LLM和RAG配置
- **测试功能**: 一键测试连接
- **清除功能**: 支持清除单项或所有配置
- **预设样例**: 提供常见系统的配置样例（如Dify）
