# RAG评测系统 API 接口文档（详细版）

## 目录
1. [认证 API](#1-认证-api)
2. [用户 API](#2-用户-api)
3. [项目 API](#3-项目-api)
4. [问题 API](#4-问题-api)
5. [RAG回答 API](#5-rag回答-api)
6. [评测 API](#6-评测-api)
7. [自动评测 API](#7-自动评测-api)
8. [人工评测 API](#8-人工评测-api)
9. [报告 API](#9-报告-api)
10. [性能测试 API](#10-性能测试-api)

所有API路径前缀: `/api/v1`

---

## 1. 认证 API

### 1.1 用户登录
- **路径**: `/auth/login`
- **方法**: `POST`
- **请求体**:
  ```json
  {
    "email": "user@example.com",  // 用户邮箱，必填
    "password": "userpassword"       // 用户密码，必填
  }
  ```
- **响应**:
  ```json
  {
    "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",  // JWT访问令牌
    "token_type": "bearer"                                      // 令牌类型
  }
  ```
- **错误响应**:
  - `401 Unauthorized`: 用户名或密码错误
  ```json
  {
    "detail": "用户名或密码错误"
  }
  ```

### 1.2 用户注册
- **路径**: `/auth/register`
- **方法**: `POST`
- **请求体**:
  ```json
  {
    "email": "user@example.com",  // 用户邮箱，必填，唯一
    "password": "userpassword",   // 用户密码，必填，至少8个字符
    "name": "用户名称",           // 用户名称，可选
    "company": "公司名称",        // 公司名称，可选
    "bio": "个人简介",            // 个人简介，可选
    "avatar_url": "头像URL"       // 头像URL，可选
  }
  ```
- **响应**:
  ```json
  {
    "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",  // JWT访问令牌
    "token_type": "bearer"                                      // 令牌类型
  }
  ```
- **错误响应**:
  - `400 Bad Request`: 邮箱已被注册
  ```json
  {
    "detail": "该邮箱已被注册"
  }
  ```

---

## 2. 用户 API

### 2.1 获取所有用户
- **路径**: `/users`
- **方法**: `GET`
- **查询参数**:
  - `skip`: 跳过记录数，整数，默认0
  - `limit`: 返回记录数，整数，默认100
- **权限**: 仅管理员
- **响应**:
  ```json
  [
    {
      "id": "uuid字符串",
      "email": "user@example.com",
      "name": "用户名称",
      "company": "公司名称",
      "bio": "个人简介",
      "avatar_url": "头像URL",
      "is_active": true,
      "is_admin": false,
      "created_at": "2023-01-01T00:00:00Z",
      "updated_at": "2023-01-01T00:00:00Z"
    }
  ]
  ```
- **错误响应**:
  - `403 Forbidden`: 权限不足
  ```json
  {
    "detail": "权限不足"
  }
  ```

### 2.2 创建新用户
- **路径**: `/users`
- **方法**: `POST`
- **请求体**:
  ```json
  {
    "email": "user@example.com",  // 用户邮箱，必填，唯一
    "password": "userpassword",   // 用户密码，必填
    "name": "用户名称",           // 用户名称，可选
    "company": "公司名称",        // 公司名称，可选
    "bio": "个人简介",            // 个人简介，可选
    "avatar_url": "头像URL",      // 头像URL，可选
    "is_active": true,            // 是否激活，布尔值，默认true
    "is_admin": false             // 是否管理员，布尔值，默认false
  }
  ```
- **权限**: 仅管理员
- **响应**: 创建的用户信息
  ```json
  {
    "id": "uuid字符串",
    "email": "user@example.com",
    "name": "用户名称",
    "company": "公司名称",
    "bio": "个人简介",
    "avatar_url": "头像URL",
    "is_active": true,
    "is_admin": false,
    "created_at": "2023-01-01T00:00:00Z",
    "updated_at": "2023-01-01T00:00:00Z"
  }
  ```
- **错误响应**:
  - `400 Bad Request`: 邮箱已被注册
  - `403 Forbidden`: 权限不足

### 2.3 获取当前用户信息
- **路径**: `/users/me`
- **方法**: `GET`
- **响应**: 当前用户信息
  ```json
  {
    "id": "uuid字符串",
    "email": "user@example.com",
    "name": "用户名称",
    "company": "公司名称",
    "bio": "个人简介",
    "avatar_url": "头像URL",
    "is_active": true,
    "is_admin": false,
    "created_at": "2023-01-01T00:00:00Z",
    "updated_at": "2023-01-01T00:00:00Z"
  }
  ```

### 2.4 更新当前用户信息
- **路径**: `/users/me`
- **方法**: `PUT`
- **请求体**: 用户更新信息（所有字段均为可选）
  ```json
  {
    "password": "newpassword",    // 新密码，可选
    "name": "新用户名称",         // 新用户名称，可选
    "email": "newemail@example.com", // 新邮箱，可选
    "company": "新公司名称",      // 新公司名称，可选
    "bio": "新个人简介",          // 新个人简介，可选
    "avatar_url": "新头像URL"     // 新头像URL，可选
  }
  ```
- **响应**: 更新后的用户信息
  ```json
  {
    "id": "uuid字符串",
    "email": "newemail@example.com",
    "name": "新用户名称",
    "company": "新公司名称",
    "bio": "新个人简介",
    "avatar_url": "新头像URL",
    "is_active": true,
    "is_admin": false,
    "created_at": "2023-01-01T00:00:00Z",
    "updated_at": "2023-01-01T00:00:00Z"
  }
  ```

### 2.5 获取指定用户信息
- **路径**: `/users/{user_id}`
- **方法**: `GET`
- **路径参数**:
  - `user_id`: 用户ID，UUID字符串
- **响应**: 用户信息
  ```json
  {
    "id": "uuid字符串",
    "email": "user@example.com",
    "name": "用户名称",
    "company": "公司名称",
    "bio": "个人简介",
    "avatar_url": "头像URL",
    "is_active": true,
    "is_admin": false,
    "created_at": "2023-01-01T00:00:00Z",
    "updated_at": "2023-01-01T00:00:00Z"
  }
  ```
- **错误响应**:
  - `404 Not Found`: 用户未找到
  - `403 Forbidden`: 权限不足（非管理员只能查看自己的信息）

### 2.6 更新指定用户信息
- **路径**: `/users/{user_id}`
- **方法**: `PUT`
- **路径参数**:
  - `user_id`: 用户ID，UUID字符串
- **请求体**: 用户更新信息（所有字段均为可选）
  ```json
  {
    "password": "newpassword",    // 新密码，可选
    "name": "新用户名称",         // 新用户名称，可选
    "email": "newemail@example.com", // 新邮箱，可选
    "company": "新公司名称",      // 新公司名称，可选
    "bio": "新个人简介",          // 新个人简介，可选
    "avatar_url": "新头像URL",    // 新头像URL，可选
    "is_active": true,            // 是否激活，布尔值，可选
    "is_admin": false             // 是否管理员，布尔值，可选
  }
  ```
- **权限**: 仅管理员
- **响应**: 更新后的用户信息
  ```json
  {
    "id": "uuid字符串",
    "email": "newemail@example.com",
    "name": "新用户名称",
    "company": "新公司名称",
    "bio": "新个人简介",
    "avatar_url": "新头像URL",
    "is_active": true,
    "is_admin": false,
    "created_at": "2023-01-01T00:00:00Z",
    "updated_at": "2023-01-01T00:00:00Z"
  }
  ```
- **错误响应**:
  - `404 Not Found`: 用户未找到
  - `403 Forbidden`: 权限不足

### 2.7 删除用户
- **路径**: `/users/{user_id}`
- **方法**: `DELETE`
- **路径参数**:
  - `user_id`: 用户ID，UUID字符串
- **权限**: 仅管理员
- **响应**: 删除的用户信息
  ```json
  {
    "id": "uuid字符串",
    "email": "user@example.com",
    "name": "用户名称",
    "company": "公司名称",
    "bio": "个人简介",
    "avatar_url": "头像URL",
    "is_active": true,
    "is_admin": false,
    "created_at": "2023-01-01T00:00:00Z",
    "updated_at": "2023-01-01T00:00:00Z"
  }
  ```
- **错误响应**:
  - `404 Not Found`: 用户未找到
  - `403 Forbidden`: 权限不足

### 2.8 创建API密钥
- **路径**: `/users/api-keys`
- **方法**: `POST`
- **请求体**:
  ```json
  {
    "name": "OpenAI API密钥",     // 密钥名称，必填
    "key": "sk-xxxx",             // API密钥值，必填
    "provider": "openai",         // 提供商，必填，如openai, anthropic等
    "is_active": true             // 是否激活，布尔值，默认true
  }
  ```
- **响应**: 创建的API密钥信息
  ```json
  {
    "id": "uuid字符串",
    "user_id": "用户ID",
    "name": "OpenAI API密钥",
    "key": "sk-xxxx",
    "provider": "openai",
    "is_active": true,
    "created_at": "2023-01-01T00:00:00Z",
    "updated_at": "2023-01-01T00:00:00Z"
  }
  ```

### 2.9 获取所有API密钥
- **路径**: `/users/api-keys`
- **方法**: `GET`
- **响应**: 用户的所有API密钥列表
  ```json
  [
    {
      "id": "uuid字符串",
      "user_id": "用户ID",
      "name": "OpenAI API密钥",
      "key": "sk-xxxx",
      "provider": "openai",
      "is_active": true,
      "created_at": "2023-01-01T00:00:00Z",
      "updated_at": "2023-01-01T00:00:00Z"
    }
  ]
  ```

### 2.10 更新API密钥
- **路径**: `/users/api-keys/{api_key_id}`
- **方法**: `PUT`
- **路径参数**:
  - `api_key_id`: API密钥ID，UUID字符串
- **请求体**: API密钥更新信息（所有字段均为可选）
  ```json
  {
    "name": "新密钥名称",         // 新密钥名称，可选
    "key": "sk-yyyy",             // 新API密钥值，可选
    "provider": "anthropic",      // 新提供商，可选
    "is_active": false            // 是否激活，布尔值，可选
  }
  ```
- **响应**: 更新后的API密钥信息
  ```json
  {
    "id": "uuid字符串",
    "user_id": "用户ID",
    "name": "新密钥名称",
    "key": "sk-yyyy",
    "provider": "anthropic",
    "is_active": false,
    "created_at": "2023-01-01T00:00:00Z",
    "updated_at": "2023-01-01T00:00:00Z"
  }
  ```
- **错误响应**:
  - `404 Not Found`: API密钥未找到
  - `403 Forbidden`: 无权更新此API密钥

### 2.11 删除API密钥
- **路径**: `/users/api-keys/{api_key_id}`
- **方法**: `DELETE`
- **路径参数**:
  - `api_key_id`: API密钥ID，UUID字符串
- **响应**: 操作结果
  ```json
  {
    "detail": "API密钥已删除"
  }
  ```
- **错误响应**:
  - `404 Not Found`: API密钥未找到
  - `403 Forbidden`: 无权删除此API密钥

---