# RAG评测系统功能进度

## 后端已实现功能

✅ **用户账户与认证系统**
- 用户数据模型 (models/user.py)
- 认证机制 (core/security.py)
- 登录和注册API (api_v1/endpoints/auth.py)
- 用户服务逻辑 (services/user_service.py)

✅ **项目管理功能**
- 项目数据模型 (models/project.py)
- 项目API接口 (api_v1/endpoints/projects.py)
- 评测维度配置

✅ **问答数据管理**
- 问题数据模型 (models/question.py)
- 问题CRUD接口 (api_v1/endpoints/questions.py)
- 问题生成功能 (services/llm_service.py)
- 批量问题导入

✅ **RAG回答收集**
- RAG回答数据模型 (models/rag_answer.py)
- RAG回答接口 (api_v1/endpoints/rag_answers.py)
- RAG服务实现 (services/rag_service.py)
- 支持API调用和手动导入

✅ **评测引擎**
- 评测数据模型 (models/evaluation.py)
- 评测服务实现 (services/evaluation_service.py)
- 自动评测接口 (api_v1/endpoints/auto_evaluation.py)
- 人工评测接口 (api_v1/endpoints/manual_evaluation.py)
- 评测管理接口 (api_v1/endpoints/evaluations.py)

✅ **报告生成**
- 报告数据模型 (models/report.py)
- 报告服务 (services/report_service.py)
- 报告API (api_v1/endpoints/reports.py)
- 支持多种报告类型和导出格式

✅ **性能测试**
- 性能测试数据模型 (models/performance.py)
- 性能测试服务 (services/performance_service.py)
- 性能测试接口 (api_v1/endpoints/performance.py)
- 并发测试与性能分析

## 所有功能已实现完成


rag-evaluation-backend/
├── app/
│   ├── api/
│   │   ├── api_v1/
│   │   │   ├── endpoints/
│   │   │   │   ├── users.py
│   │   │   │   ├── auth.py
│   │   │   │   ├── projects.py
│   │   │   │   ├── questions.py
│   │   │   │   ├── rag_answers.py
│   │   │   │   ├── evaluations.py
│   │   │   │   ├── auto_evaluation.py
│   │   │   │   ├── manual_evaluation.py
│   │   │   │   ├── reports.py
│   │   │   │   └── performance.py
│   │   │   └── api.py
│   │   └── deps.py
│   ├── core/
│   │   ├── config.py
│   │   └── security.py
│   │
│   ├── db/
│   │   ├── base.py
│   │   ├── create.sql
│   │   ├── init_db.py
│   │   └── seed_db.py
│   │
│   ├── models/
│   │   ├── user.py
│   │   ├── project.py
│   │   ├── question.py
│   │   ├── rag_answer.py
│   │   ├── evaluation.py
│   │   └── performance.py
│   │
│   ├── schemas/
│   │   ├── user.py
│   │   ├── project.py
│   │   ├── question.py
│   │   ├── rag_answer.py
│   │   ├── evaluation.py
│   │   ├── performance.py
│   │   └── report.py
│   │
│   ├── services/
│   │   ├── user_service.py
│   │   ├── project_service.py
│   │   ├── question_service.py
│   │   ├── rag_service.py
│   │   ├── evaluation_service.py
│   │   ├── auto_evaluator.py
│   │   ├── report_service.py
│   │   └── llm_service.py
│   │
│   ├── utils/
│   │   ├── security.py
│   │   └── file_handlers.py
│   │
│   ├── __init__.py
│   └── main.py
│
└── requirements.txt 


# RAG评测系统功能设计文档

## 技术栈
### 前端
- **框架**: React 18 + TypeScript
- **UI组件**: Ant Design + ProComponents
- **状态管理**: Redux Toolkit
- **路由**: React Router v6
- **数据可视化**: AntV (G2Plot/BizCharts)
- **HTTP客户端**: Axios
- **表单处理**: Formik + Yup
- **构建工具**: Vite
- **代码规范**: ESLint + Prettier

### 后端
- **框架**: FastAPI (Python)
- **ORM**: SQLAlchemy
- **数据库**: PostgreSQL
- **缓存**: Redis
- **任务队列**: Celery
- **API文档**: Swagger UI (FastAPI内置)
- **认证**: JWT + OAuth2

### 部署与DevOps
- **容器化**: Docker + Docker Compose
- **CI/CD**: GitHub Actions
- **监控**: Prometheus + Grafana
- **日志**: ELK Stack (可选)

### 系统架构图

┌─────────────────────────────────────────────────────────────┐
│                      客户端 (浏览器)                          │
└───────────────────────────┬─────────────────────────────────┘
                            │
┌───────────────────────────▼─────────────────────────────────┐
│                      前端应用 (React)                         │
│                                                             │
│  ┌─────────────┐   ┌────────────┐   ┌────────────────────┐  │
│  │  组件 (Ant   │   │ 状态管理    │   │ 路由 (React Router) │  │
│  │   Design)   │   │ (Redux)    │   │                    │  │
│  └─────────────┘   └────────────┘   └────────────────────┘  │
│                                                             │
│  ┌─────────────┐   ┌────────────┐   ┌────────────────────┐  │
│  │ 图表 (AntV)  │   │ API客户端   │   │ 表单处理 (Formik)   │  │
│  │             │   │ (Axios)    │   │                    │  │
│  └─────────────┘   └────────────┘   └────────────────────┘  │
└───────────────────────────┬─────────────────────────────────┘
                            │
┌───────────────────────────▼─────────────────────────────────┐
│                     API网关 (Nginx)                          │
└───────────────────────────┬─────────────────────────────────┘
                            │
┌───────────────────────────▼─────────────────────────────────┐
│                    后端服务 (FastAPI)                         │
│                                                             │
│  ┌─────────────┐   ┌────────────┐   ┌────────────────────┐  │
│  │ 用户管理     │   │ 项目管理    │   │ 问答数据管理         │  │
│  └─────────────┘   └────────────┘   └────────────────────┘  │
│                                                             │
│  ┌─────────────┐   ┌────────────┐   ┌────────────────────┐  │
│  │ RAG回答收集  │   │ 评测引擎    │   │ 报告生成            │  │
│  └─────────────┘   └────────────┘   └────────────────────┘  │
└───┬───────────────────┬───────────────────┬─────────────────┘
    │                   │                   │
┌───▼───────┐   ┌───────▼───────┐   ┌───────▼───────┐
│ PostgreSQL │   │ Redis缓存     │   │ Celery任务队列 │
└───────────┘   └───────────────┘   └───────────────┘

## 1. 文档概述

### 1.1 目的与范围

本文档详细说明RAG评测系统的功能设计，重点关注核心功能和用户体验。系统设计秉承"简单易用"原则，让用户无需复杂配置即可快速评测RAG系统的回答准确性。

### 1.2 术语说明

- **RAG**：检索增强生成（Retrieval-Augmented Generation）
- **数据集**：包含问题和标准答案的集合，可被多个项目共享
- **问答对**：包含问题和标准答案的数据项
- **实际回答**：用户RAG系统对问题的回答结果
- **评测报告**：展示RAG系统性能的分析结果

## 2. 系统概览

### 2.1 技术架构

前端采用React框架构建简洁直观的界面，后端使用Python技术栈（FastAPI）开发API，数据存储采用PostgreSQL数据库。

### 2.2 核心功能模块

1. 用户账户（简化版）
2. 数据集管理
3. 评测项目
4. 问答数据管理
5. RAG回答收集
6. 自动评测引擎
7. 人工评测模块
8. 评测报告

## 3. 用户账户模块

### 3.1 快速注册与登录

- **简易注册**：
  - 仅需邮箱和密码
  - 可选GitHub一键登录
- **无验证流程**：注册即可使用，避免邮箱验证等额外步骤
- **保存设置**：记住登录状态，减少重复登录

### 3.2 用户个人设置
- **个人信息**：
  - 个人资料编辑
  - 密码修改
- **API密钥管理**：
  - 创建和删除个人API密钥

## 4. 数据集管理模块

### 4.1 数据集创建与管理

- **简易创建流程**：
  - 数据集名称、描述和可见性设置
  - 支持公开/私有选项
  - 标签分类功能

- **数据集列表视图**：
  - 数据集卡片展示
  - 筛选功能（名称、标签、创建时间）
  - 快速预览数据集内容

### 4.2 问答对管理

#### 4.2.1 多种数据获取方式

- **Excel/CSV简易导入**：
  - 拖拽上传支持
  - 智能列名识别
  - 提供标准模板下载

- **基于大模型生成问答对**：
  - 根据知识库内容生成问题和标准答案
  - 支持文本直接输入或文件上传
  - 生成参数配置（难度、类型、数量）

#### 4.2.2 问答数据管理

- **列表视图**：简洁的问题和答案列表
- **快速编辑**：行内直接编辑问题和答案
- **批量操作**：删除、移动到其他数据集
- **搜索功能**：关键词搜索特定问题

### 4.3 数据集共享

- **权限设置**：
  - 完全私有（仅创建者可见）
  - 组织内共享（同组织用户可见）
  - 完全公开（所有用户可见）
  
- **共享链接**：生成可共享的链接供其他用户导入

## 5. 评测项目模块

### 5.1 一键创建项目

- **简化创建流程**：
  - 项目名称和描述
  - 选择已有数据集（可选择多个）
  - 预设默认评测标准
  
- **项目卡片展示**：
  - 直观的项目卡片视图
  - 显示关键信息（名称、创建时间、评测状态）
  - 一键进入评测流程

### 5.2 评测配置

#### 5.2.1 评测标准设置
- **评测维度**：
  - 准确性（事实一致性）
  - 相关性（回答与问题的匹配度）
  - 完整性（信息覆盖度）
  - 简洁性（无冗余信息）
- **评分规则**：
  - 二元评分（正确/错误）
  - 三分量表（较差/一般/优秀）
  - 五分量表（1-5分）
  - 自定义评分标准
- **权重设置**：
  - 各维度权重调整
  - 评分规则权重

#### 5.2.2 评测流程配置
- **评测方式**：
  - 自动评测
  - 人工评测
  - 混合评测（先自动后人工审核）
- **评测设置**：
  - 评测批次大小
  - 时间限制
  - 评测人分配规则

## 6. RAG回答收集模块

### 6.1 API接口设置

- **简化接口配置**：
  - URL输入框
  - 简单认证选项（无认证/API密钥/Basic认证）
  - 可选请求参数配置
- **一键测试**：验证接口连接是否正常

### 6.2 批量回答收集

- **一键批量请求**：
  - 自动发送所有问题到RAG接口
  - 简单进度展示
  - 错误重试选项
- **Excel导入回答**：
  - 支持直接上传包含RAG回答的Excel
  - 自动匹配问题和回答

## 7. 自动评测引擎

### 7.1 简化评测流程

- **一键启动评测**：无需复杂配置，立即开始评测
- **评测进度展示**：直观进度条和状态更新
- **配置模型**：均采用OpenAI的方式，需提前配置Key、BaseURL、ModelName

### 7.2 评测维度

- **核心维度**：
  - 准确性（默认）：与标准答案的一致程度
  - 可选额外维度：相关性、完整性、简洁性
- **评分方式**：
  - 默认三分制：正确/部分正确/错误
  - 可选二分制或五分制

### 7.3 高级选项（可折叠）

- **模型选择**：切换不同评测模型
- **评测提示词**：简单调整评测指令
- **评测详细程度**：选择简易或详细评测

### 7.3 性能评测功能

#### 7.3.1 性能指标收集
- **并发请求控制**：
  - 支持设置并发请求数量（1-20）
  - 提供不同的性能测试模式（标准模式、压力测试、稳定性测试）
  
- **响应时间指标**：
  - 首次响应时间：从发送请求到系统开始返回数据的时间
  - 总响应时间：从发送请求到接收完整回答的时间
  - 字符数量：回答的总字符数
  - 每秒字符数：回答生成速度的近似指标

- **系统性能指标**：
  - 吞吐量：单位时间内处理的请求数
  - 请求成功率：成功响应的请求占总请求的比例
  - 并发性能下降率：随着并发数增加，响应时间的增长率

#### 7.3.2 性能数据展示
- **实时性能指标**：
  - 在回答收集过程中实时显示当前性能指标
  - 提供每个问题的详细性能数据

- **性能报告**：
  - 生成性能评测报告，包含各项指标的统计数据
  - 支持与历史性能数据对比
  - 提供性能瓶颈分析和优化建议

- **性能可视化**：
  - 首次响应时间与总响应时间对比图
  - 并发负载下的性能变化图
  - 响应时间分布图
  - 生成速度随字符量的变化趋势图

#### 7.3.3 性能测试模式
- **标准模式**：均衡测试各项性能指标
- **压力测试**：测试系统在高并发下的表现
- **稳定性测试**：长时间运行测试系统的稳定性

#### 7.3.4 性能数据导出
- 支持将性能数据导出为CSV或JSON格式
- 提供性能数据的图表可视化

## 8. 人工评测模块

### 8.1 简易评测界面

- **直观评测页面**：
  - 清晰的三栏布局（问题/标准答案/RAG回答）
  - 评分控件直接显示在每个问答对下方
  - 夜间模式支持，降低长时间评测疲劳
- **评分操作**：
  - 快速评分按钮（正确/部分正确/错误）
  - 简单评分滑块（1-5分）
  - 可选简短评论输入框
- **批量评测功能**：
  - 列表视图同时展示多个问答对
  - 批量应用相同评分
  - 记住上次停留位置，支持分批评测

### 8.2 评测辅助功能

- **简易对比工具**：
  - 自动高亮RAG回答与标准答案的差异
  - 关键词匹配突出显示
- **评测进度**：
  - 直观进度条显示（已评测/总数量）
  - 简单统计（平均分、已完成百分比）
- **记录功能**：
  - 自动保存评测结果
  - 简单筛选（已评测/未评测/有问题的项目）

### 8.3 混合评测模式

- **设计说明**：结合自动评测和人工评测优势
- **工作流程**：
  1. 先进行自动评测获得初步结果
  2. 人工重点审核可疑或有争议的回答
  3. 人工可一键确认或修改自动评测结果
- **重点审核推荐**：
  - 自动标记评分较低的问题
  - 标记自动评测低置信度的问题
  - 用户可设置分数阈值触发人工审核

### 8.4 简化版评测指南

- **内嵌评分标准**：
  - 每个评分选项附带简短解释
  - 可访问评分示例（好/中/差的样例）
- **评测提示**：
  - 简短提示帮助保持评测一致性
  - 常见误区提醒

## 9. 评测报告模块

### 9.1 一目了然的评测结果

- **总体评分**：
  - 分数和百分比展示
  - 简单色彩编码（红/黄/绿）
  - 与历史对比（如有）
- **问题分布**：
  - 按评分分布的简单图表
  - 问题类型表现对比

### 9.2 问题详情

- **列表视图**：
  - 问题-标准答案-RAG回答-评分的并排展示
  - 按评分排序（最差在前）
  - 简单筛选功能
- **详情查看**：
  - 点击展开完整内容
  - 评测理由展示
  - 简单的差异高亮

### 9.3 简易导出功能

- **一键导出**：
  - PDF报告
  - Excel详细结果
  - 问题集导出（仅错误问题）

## 10. 辅助功能

### 10.1 用户指引

- **入门指南**：系统首次使用的简易教程
- **内嵌提示**：关键功能旁的简短提示
- **示例项目**：预置示例，帮助理解工作流

### 10.2 数据管理

- **自动保存**：自动保存所有操作和数据
- **简单历史**：查看和恢复最近的评测结果
- **数据清理**：简单的数据清理选项

## 11. 技术实现要点

### 11.1 前端设计原则

- **最小点击原则**：核心功能不超过3次点击
- **默认值优先**：关键配置提供合理默认值
- **渐进式复杂性**：基本功能显著，高级功能可展开
- **响应式设计**：适配不同设备尺寸

### 11.2 后端设计原则

- **快速响应**：优化API响应时间
- **异步处理**：长时间任务（如批量评测）异步处理
- **错误恢复**：自动重试和错误恢复机制
- **缓存策略**：合理缓存常用数据

### 11.3 数据模型（简化版）

- **用户表**：基本用户信息
- **项目表**：评测项目信息
- **问答表**：问题、标准答案和RAG回答
- **评测结果表**：评测得分和反馈
- **系统配置表**：基本系统设置

## 12. 接口设计

### 12.1 外部API

- **RAG系统接口集成**：
  - POST请求格式规范
  - 响应格式规范
  - 错误处理规范
- **评测模型接口**：
  - 预设提示模板
  - 评分规则标准化

### 12.2 系统API

- **RESTful设计**：
  - 资源明确命名
  - HTTP方法语义化使用
  - 状态码规范化
- **轻量级响应**：
  - JSON格式
  - 必要字段最小化
  - 分页支持

## 13. 部署与扩展

### 13.1 简化部署

- **Docker一键部署**：预配置容器
- **环境变量配置**：最小化配置需求
- **自动初始化**：首次启动自动配置

### 13.2 未来扩展点

- **多语言支持**
- **更多评测模型接入**
- **团队协作功能**
- **自定义评测标准**

## 14. 数据安全

- **基本认证安全**：密码加密存储
- **数据隔离**：用户数据严格隔离
- **最小权限原则**：API访问控制
- **数据备份**：自动备份机制 